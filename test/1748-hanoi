#!/bin/sh
# -*- tcl -*-
# The next line is executed by /bin/sh, but not tcl \
exec tclsh "$0" ${1+"$@"}

# See if the towers of hanoi solving vi macros work

source term
start_vi

# Read the macros
exp_send ":so hanoi\r"

# Buffer should still be empty and there should be no error messages
# on the status line
# vim has trailing line,column info.
# nvi leaves the status line blank if successful

set screen [list "" "~"]
term_expect timeout { exit 100 } \
    { screen_is 1 0 $screen }
term_expect timeout {
	puts "After :so hanoi, status line is \"[statusline]\"."
	exit 101
    } \
    { statusline_starts ":so hanoi" } { } \
    { statusline_is "" } { }

# Run the initialization code
exp_send "I"
set screen [list "" "01234567" "0" "0" "" "" "T0123456n" "T0123456$" "/" "~"]
term_expect timeout { exit 111 } \
    { screen_is 9 0 $screen }

# Run the main loop
exp_send "L"
set timeout 10
set screen [list "" "0" "01234567" "0" "" "" "T0123456n" "T0123456$" "/" "~"]
term_expect timeout { exit 112 } \
    { screen_is 2 0 $screen }

exp_send ":q!\r"

exit 0
